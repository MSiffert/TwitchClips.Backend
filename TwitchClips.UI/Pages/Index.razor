@page "/"
@using TwitchClips.API.Api

<PageTitle>Index</PageTitle>

<MudText Typo="Typo.h3" GutterBottom="true">Hello, world!</MudText>
<MudText Class="mb-8">Welcome to your new app, powered by MudBlazor!</MudText>
<MudAlert Severity="Severity.Normal">You can find documentation and examples on our website here: <MudLink Href="https://mudblazor.com" Typo="Typo.body2" Color="Color.Inherit"><b>www.mudblazor.com</b></MudLink></MudAlert>

@if (Clips.Any())
{
    @foreach (var clip in Clips)
    {
        <iframe
            src="@(clip.EmbedUrl + "&parent=app-twitchclips.azurewebsites.net")"
            frameborder="0"
            muted="false"
            allowfullscreen="true"
        >
        </iframe>
    }
}

<MudText>
    @NumberOfClips
</MudText>

@code {

    [Inject]
    public HttpClient HttpClient { get; set; }
    
    public List<Clip> Clips { get; set; }
    public int NumberOfClips => Clips.Count;

    public Index()
    {
        Clips = new List<Clip>();
    }
    
    protected override async Task OnInitializedAsync()
    {
        var clips = await HttpClient.GetAsync("clips?gameId=21779");
        var response = await clips.Content.ReadFromJsonAsync<ClipsResponse>() ?? throw new Exception();
        Console.WriteLine(response.Data.First().EmbedUrl);
        Clips = response.Data;
    }
}